# Docker Compose for local development
version: '3.8'

services:
  ai-service:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: ai-study-assistant
    ports:
      - "${PORT:-8001}:8001"
    environment:
      - QDRANT_URL=${QDRANT_URL}
      - QDRANT_API_KEY=${QDRANT_API_KEY}
      - COHERE_API_KEY=${COHERE_API_KEY}
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - API_SERVER_URL=${API_SERVER_URL:-https://api.mergeedu.app}
      - COLLECTION_NAME=${COLLECTION_NAME:-study_materials}
      - CHUNK_SIZE=${CHUNK_SIZE:-512}
      - CHUNK_OVERLAP=${CHUNK_OVERLAP:-100}
      - TOP_K_RESULTS=${TOP_K_RESULTS:-5}
      - MIN_RELEVANCE_SCORE=${MIN_RELEVANCE_SCORE:-0.3}
      - MAX_FILE_SIZE_MB=${MAX_FILE_SIZE_MB:-10}
      - PORT=8001
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - ENVIRONMENT=${ENVIRONMENT:-development}
    env_file:
      - .env
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "python", "-c", "import httpx; httpx.get('http://localhost:8001/health', timeout=5)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 256M

  # Optional: Local Qdrant for development
  qdrant:
    image: qdrant/qdrant:latest
    container_name: qdrant-local
    ports:
      - "6333:6333"
      - "6334:6334"
    volumes:
      - qdrant_storage:/qdrant/storage
    profiles:
      - local-qdrant

volumes:
  qdrant_storage:
